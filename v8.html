<!DOCTYPE html><html id=maincontent><head><meta charset=UTF-8><link rel=stylesheet href=css/api.css></head><body class="alt apidoc" id=api-section-v8><div id=content class=clearfix><div id=column2 class=interior><div id=intro class=interior><a href=http://nodejs.cn/ >Node.js 中文网</a><div><input placeholder="API 快速搜索" id=search_input></div></div><ul><li><a class=nav-assert href=assert.html>assert - 断言</a></li><li><a class=nav-buffer href=buffer.html>Buffer - 缓冲器</a></li><li><a class=nav-child_process href=child_process.html>child_process - 子进程</a></li><li><a class=nav-cluster href=cluster.html>cluster - 集群</a></li><li><a class=nav-console href=console.html>console - 控制台</a></li><li><a class=nav-crypto href=crypto.html>crypto - 加密</a></li><li><a class=nav-dgram href=dgram.html>dgram - 数据报</a></li><li><a class=nav-dns href=dns.html>dns - 域名服务器</a></li><li><a class=nav-errors href=errors.html>Error - 异常</a></li><li><a class=nav-events href=events.html>events - 事件</a></li><li><a class=nav-fs href=fs.html>fs - 文件系统</a></li><li><a class=nav-globals href=globals.html>global - 全局变量</a></li><li><a class=nav-http href=http.html>http - HTTP</a></li><li><a class=nav-https href=https.html>https - HTTPS</a></li><li><a class=nav-modules href=modules.html>module - 模块</a></li><li><a class=nav-net href=net.html>net - 网络</a></li><li><a class=nav-os href=os.html>os - 操作系统</a></li><li><a class=nav-path href=path.html>path - 路径</a></li><li><a class=nav-process href=process.html>process - 进程</a></li><li><a class=nav-querystring href=querystring.html>querystring - 查询字符串</a></li><li><a class=nav-readline href=readline.html>readline - 逐行读取</a></li><li><a class=nav-repl href=repl.html>repl - 交互式解释器</a></li><li><a class=nav-stream href=stream.html>stream - 流</a></li><li><a class=nav-string_decoder href=string_decoder.html>string_decoder - 字符串解码器</a></li><li><a class=nav-timers href=timers.html>timer - 定时器</a></li><li><a class=nav-tls href=tls.html>tls - 安全传输层</a></li><li><a class=nav-tty href=tty.html>tty - 终端</a></li><li><a class=nav-url href=url.html>url - 网址</a></li><li><a class=nav-util href=util.html>util - 实用工具</a></li><li><a class=nav-v8 href=v8.html>v8 - V8引擎</a></li><li><a class=nav-vm href=vm.html>vm - 虚拟机</a></li><li><a class=nav-zlib href=zlib.html>zlib - 压缩</a></li></ul><div class=line></div><ul><li><a class=nav--api-documentation-documentation_stability_index href=documentation.html>试验的API</a></li><li><a class=nav-async_hooks href=async_hooks.html>async_hooks</a></li><li><a class=nav-http2 href=http2.html>http2</a></li><li><a class=nav-inspector href=inspector.html>inspector</a></li><li><a class=nav-n-api href=n-api.html>napi</a></li></ul><div class=line></div><ul><li><a class=nav-documentation href=documentation.html>关于本文档</a></li><li><a class=nav-synopsis href=synopsis.html>用法与例子</a></li><li><a class=nav-addons href=addons.html>C++插件</a></li><li><a class=nav-cli href=cli.html>命令行选项</a></li><li><a class=nav-debugger href=debugger.html>debugger调试器</a></li><li><a class=nav-intl href=intl.html>国际化</a></li><li><a class=nav-tracing href=tracing.html>事件跟踪</a></li></ul></div><div id=column1 class="vs interior" data-id=v8><div id=apicontent><h1 id=v8>V8</h1><p><code>v8</code> 模块暴露了特定于<a href=https://developers.google.com/v8/ >V8</a>版本内置到 Node.js 二进制文件中的API. 通过以下方式使用：</p><pre><code class=lang-js>const v8 = require(&#39;v8&#39;);
</code></pre><p><em>注意</em>: APIs 和实现可能在任何时间变动。</p><h2 id=v8-cacheddataversiontag->v8.cachedDataVersionTag()</h2><p>Returns an integer representing a &quot;version tag&quot; derived from the V8 version, command line flags and detected CPU features. This is useful for determining whether a <a href=vm.html#vm_new_vm_script_code_options><code>vm.Script</code></a> <code>cachedData</code> buffer is compatible with this instance of V8.</p><h2 id=v8-getheapspacestatistics->v8.getHeapSpaceStatistics()</h2><p>Returns statistics about the V8 heap spaces, i.e. the segments which make up the V8 heap. Neither the ordering of heap spaces, nor the availability of a heap space can be guaranteed as the statistics are provided via the V8 <a href=https://v8docs.nodesource.com/node-8.0/d5/dda/classv8_1_1_isolate.html#ac673576f24fdc7a33378f8f57e1d13a4><code>GetHeapSpaceStatistics</code></a> function and may change from one V8 version to the next.</p><p>The value returned is an array of objects containing the following properties:</p><ul><li><code>space_name</code> {string}</li><li><code>space_size</code> {number}</li><li><code>space_used_size</code> {number}</li><li><code>space_available_size</code> {number}</li><li><code>physical_space_size</code> {number}</li></ul><p>For example:</p><pre><code class=lang-json>[
  {
    &quot;space_name&quot;: &quot;new_space&quot;,
    &quot;space_size&quot;: 2063872,
    &quot;space_used_size&quot;: 951112,
    &quot;space_available_size&quot;: 80824,
    &quot;physical_space_size&quot;: 2063872
  },
  {
    &quot;space_name&quot;: &quot;old_space&quot;,
    &quot;space_size&quot;: 3090560,
    &quot;space_used_size&quot;: 2493792,
    &quot;space_available_size&quot;: 0,
    &quot;physical_space_size&quot;: 3090560
  },
  {
    &quot;space_name&quot;: &quot;code_space&quot;,
    &quot;space_size&quot;: 1260160,
    &quot;space_used_size&quot;: 644256,
    &quot;space_available_size&quot;: 960,
    &quot;physical_space_size&quot;: 1260160
  },
  {
    &quot;space_name&quot;: &quot;map_space&quot;,
    &quot;space_size&quot;: 1094160,
    &quot;space_used_size&quot;: 201608,
    &quot;space_available_size&quot;: 0,
    &quot;physical_space_size&quot;: 1094160
  },
  {
    &quot;space_name&quot;: &quot;large_object_space&quot;,
    &quot;space_size&quot;: 0,
    &quot;space_used_size&quot;: 0,
    &quot;space_available_size&quot;: 1490980608,
    &quot;physical_space_size&quot;: 0
  }
]
</code></pre><h2 id=v8-getheapstatistics->v8.getHeapStatistics()</h2><p>Returns an object with the following properties:</p><ul><li><code>total_heap_size</code> {number}</li><li><code>total_heap_size_executable</code> {number}</li><li><code>total_physical_size</code> {number}</li><li><code>total_available_size</code> {number}</li><li><code>used_heap_size</code> {number}</li><li><code>heap_size_limit</code> {number}</li><li><code>malloced_memory</code> {number}</li><li><code>peak_malloced_memory</code> {number}</li><li><code>does_zap_garbage</code> {number}</li></ul><p><code>does_zap_garbage</code> is a 0/1 boolean, which signifies whether the <code>--zap_code_space</code> option is enabled or not. This makes V8 overwrite heap garbage with a bit pattern. The RSS footprint (resident memory set) gets bigger because it continuously touches all heap pages and that makes them less likely to get swapped out by the operating system.</p><p>For example:</p><pre><code class=lang-js>{
  total_heap_size: 7326976,
  total_heap_size_executable: 4194304,
  total_physical_size: 7326976,
  total_available_size: 1152656,
  used_heap_size: 3476208,
  heap_size_limit: 1535115264,
  malloced_memory: 16384,
  peak_malloced_memory: 1127496,
  does_zap_garbage: 0
}
</code></pre><h2 id=v8-setflagsfromstring-string->v8.setFlagsFromString(string)</h2><p>The <code>v8.setFlagsFromString()</code> method can be used to programmatically set V8 command line flags. This method should be used with care. Changing settings after the VM has started may result in unpredictable behavior, including crashes and data loss; or it may simply do nothing.</p><p>The V8 options available for a version of Node.js may be determined by running <code>node --v8-options</code>. An unofficial, community-maintained list of options and their effects is available <a href=https://github.com/thlorenz/v8-flags/blob/master/flags-0.11.md>here</a>.</p><p>Usage:</p><pre><code class=lang-js>// Print GC events to stdout for one minute.
const v8 = require(&#39;v8&#39;);
v8.setFlagsFromString(&#39;--trace_gc&#39;);
setTimeout(function() { v8.setFlagsFromString(&#39;--notrace_gc&#39;); }, 60e3);
</code></pre><h2 id=serialization-api>Serialization API</h2><blockquote><p>Stability: 1 - Experimental</p></blockquote><p>The serialization API provides means of serializing JavaScript values in a way that is compatible with the <a href=https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm>HTML structured clone algorithm</a>. The format is backward-compatible (i.e. safe to store to disk).</p><p><em>Note</em>: This API is under development, and changes (including incompatible changes to the API or wire format) may occur until this warning is removed.</p><h3 id=v8-serialize-value->v8.serialize(value)</h3><ul><li>Returns: {Buffer}</li></ul><p>Uses a <a href=#v8_class_v8_defaultserializer><code>DefaultSerializer</code></a> to serialize <code>value</code> into a buffer.</p><h3 id=v8-deserialize-buffer->v8.deserialize(buffer)</h3><ul><li><code>buffer</code> {Buffer|Uint8Array} A buffer returned by <a href=#v8_v8_serialize_value><code>serialize()</code></a>.</li></ul><p>Uses a <a href=#v8_class_v8_defaultdeserializer><code>DefaultDeserializer</code></a> with default options to read a JS value from a buffer.</p><h3 id=class-v8-serializer>class: v8.Serializer</h3><h4 id=new-serializer->new Serializer()</h4><p>Creates a new <code>Serializer</code> object.</p><h4 id=serializer-writeheader->serializer.writeHeader()</h4><p>Writes out a header, which includes the serialization format version.</p><h4 id=serializer-writevalue-value->serializer.writeValue(value)</h4><p>Serializes a JavaScript value and adds the serialized representation to the internal buffer.</p><p>This throws an error if <code>value</code> cannot be serialized.</p><h4 id=serializer-releasebuffer->serializer.releaseBuffer()</h4><p>Returns the stored internal buffer. This serializer should not be used once the buffer is released. Calling this method results in undefined behavior if a previous write has failed.</p><h4 id=serializer-transferarraybuffer-id-arraybuffer->serializer.transferArrayBuffer(id, arrayBuffer)</h4><ul><li><code>id</code> {integer} A 32-bit unsigned integer.</li><li><code>arrayBuffer</code> {ArrayBuffer} An <code>ArrayBuffer</code> instance.</li></ul><p>Marks an <code>ArrayBuffer</code> as havings its contents transferred out of band. Pass the corresponding <code>ArrayBuffer</code> in the deserializing context to <a href=#v8_deserializer_transferarraybuffer_id_arraybuffer><code>deserializer.transferArrayBuffer()</code></a>.</p><h4 id=serializer-writeuint32-value->serializer.writeUint32(value)</h4><ul><li><code>value</code> {integer}</li></ul><p>Write a raw 32-bit unsigned integer. For use inside of a custom <a href=#v8_serializer_writehostobject_object><code>serializer._writeHostObject()</code></a>.</p><h4 id=serializer-writeuint64-hi-lo->serializer.writeUint64(hi, lo)</h4><ul><li><code>hi</code> {integer}</li><li><code>lo</code> {integer}</li></ul><p>Write a raw 64-bit unsigned integer, split into high and low 32-bit parts. For use inside of a custom <a href=#v8_serializer_writehostobject_object><code>serializer._writeHostObject()</code></a>.</p><h4 id=serializer-writedouble-value->serializer.writeDouble(value)</h4><ul><li><code>value</code> {number}</li></ul><p>Write a JS <code>number</code> value. For use inside of a custom <a href=#v8_serializer_writehostobject_object><code>serializer._writeHostObject()</code></a>.</p><h4 id=serializer-writerawbytes-buffer->serializer.writeRawBytes(buffer)</h4><ul><li><code>buffer</code> {Buffer|Uint8Array}</li></ul><p>Write raw bytes into the serializer’s internal buffer. The deserializer will require a way to compute the length of the buffer. For use inside of a custom <a href=#v8_serializer_writehostobject_object><code>serializer._writeHostObject()</code></a>.</p><h4 id=serializer-_writehostobject-object->serializer._writeHostObject(object)</h4><ul><li><code>object</code> {Object}</li></ul><p>This method is called to write some kind of host object, i.e. an object created by native C++ bindings. If it is not possible to serialize <code>object</code>, a suitable exception should be thrown.</p><p>This method is not present on the <code>Serializer</code> class itself but can be provided by subclasses.</p><h4 id=serializer-_getdatacloneerror-message->serializer._getDataCloneError(message)</h4><ul><li><code>message</code> {string}</li></ul><p>This method is called to generate error objects that will be thrown when an object can not be cloned.</p><p>This method defaults to the <a href=errors.html#errors_class_error><code>Error</code></a> constructor and can be be overridden on subclasses.</p><h4 id=serializer-_getsharedarraybufferid-sharedarraybuffer->serializer._getSharedArrayBufferId(sharedArrayBuffer)</h4><ul><li><code>sharedArrayBuffer</code> {SharedArrayBuffer}</li></ul><p>This method is called when the serializer is going to serialize a <code>SharedArrayBuffer</code> object. It must return an unsigned 32-bit integer ID for the object, using the same ID if this <code>SharedArrayBuffer</code> has already been serialized. When deserializing, this ID will be passed to <a href=#v8_deserializer_transferarraybuffer_id_arraybuffer><code>deserializer.transferArrayBuffer()</code></a>.</p><p>If the object cannot be serialized, an exception should be thrown.</p><p>This method is not present on the <code>Serializer</code> class itself but can be provided by subclasses.</p><h4 id=serializer-_settreatarraybufferviewsashostobjects-flag->serializer._setTreatArrayBufferViewsAsHostObjects(flag)</h4><ul><li><code>flag</code> {boolean}</li></ul><p>Indicate whether to treat <code>TypedArray</code> and <code>DataView</code> objects as host objects, i.e. pass them to <a href=#v8_serializer_writehostobject_object><code>serializer._writeHostObject()</code></a>.</p><p>The default is not to treat those objects as host objects.</p><h3 id=class-v8-deserializer>class: v8.Deserializer</h3><h4 id=new-deserializer-buffer->new Deserializer(buffer)</h4><ul><li><code>buffer</code> {Buffer|Uint8Array} A buffer returned by <a href=#v8_serializer_releasebuffer><code>serializer.releaseBuffer()</code></a>.</li></ul><p>Creates a new <code>Deserializer</code> object.</p><h4 id=deserializer-readheader->deserializer.readHeader()</h4><p>Reads and validates a header (including the format version). May, for example, reject an invalid or unsupported wire format. In that case, an <code>Error</code> is thrown.</p><h4 id=deserializer-readvalue->deserializer.readValue()</h4><p>Deserializes a JavaScript value from the buffer and returns it.</p><h4 id=deserializer-transferarraybuffer-id-arraybuffer->deserializer.transferArrayBuffer(id, arrayBuffer)</h4><ul><li><code>id</code> {integer} A 32-bit unsigned integer.</li><li><code>arrayBuffer</code> {ArrayBuffer|SharedArrayBuffer} An <code>ArrayBuffer</code> instance.</li></ul><p>Marks an <code>ArrayBuffer</code> as havings its contents transferred out of band. Pass the corresponding <code>ArrayBuffer</code> in the serializing context to <a href=#v8_serializer_transferarraybuffer_id_arraybuffer><code>serializer.transferArrayBuffer()</code></a> (or return the <code>id</code> from <a href=#v8_serializer_getsharedarraybufferid_sharedarraybuffer><code>serializer._getSharedArrayBufferId()</code></a> in the case of <code>SharedArrayBuffer</code>s).</p><h4 id=deserializer-getwireformatversion->deserializer.getWireFormatVersion()</h4><ul><li>Returns: {integer}</li></ul><p>Reads the underlying wire format version. Likely mostly to be useful to legacy code reading old wire format versions. May not be called before <code>.readHeader()</code>.</p><h4 id=deserializer-readuint32->deserializer.readUint32()</h4><ul><li>Returns: {integer}</li></ul><p>Read a raw 32-bit unsigned integer and return it. For use inside of a custom <a href=#v8_deserializer_readhostobject><code>deserializer._readHostObject()</code></a>.</p><h4 id=deserializer-readuint64->deserializer.readUint64()</h4><ul><li>Returns: {Array}</li></ul><p>Read a raw 64-bit unsigned integer and return it as an array <code>[hi, lo]</code> with two 32-bit unsigned integer entries. For use inside of a custom <a href=#v8_deserializer_readhostobject><code>deserializer._readHostObject()</code></a>.</p><h4 id=deserializer-readdouble->deserializer.readDouble()</h4><ul><li>Returns: {number}</li></ul><p>Read a JS <code>number</code> value. For use inside of a custom <a href=#v8_deserializer_readhostobject><code>deserializer._readHostObject()</code></a>.</p><h4 id=deserializer-readrawbytes-length->deserializer.readRawBytes(length)</h4><ul><li>Returns: {Buffer}</li></ul><p>Read raw bytes from the deserializer’s internal buffer. The <code>length</code> parameter must correspond to the length of the buffer that was passed to <a href=#v8_serializer_writerawbytes_buffer><code>serializer.writeRawBytes()</code></a>. For use inside of a custom <a href=#v8_deserializer_readhostobject><code>deserializer._readHostObject()</code></a>.</p><h4 id=deserializer-_readhostobject->deserializer._readHostObject()</h4><p>This method is called to read some kind of host object, i.e. an object that is created by native C++ bindings. If it is not possible to deserialize the data, a suitable exception should be thrown.</p><p>This method is not present on the <code>Deserializer</code> class itself but can be provided by subclasses.</p><h3 id=class-v8-defaultserializer>class: v8.DefaultSerializer</h3><p>A subclass of <a href=#v8_class_v8_serializer><code>Serializer</code></a> that serializes <code>TypedArray</code> (in particular <a href=buffer.html><code>Buffer</code></a>) and <code>DataView</code> objects as host objects, and only stores the part of their underlying <code>ArrayBuffer</code>s that they are referring to.</p><h3 id=class-v8-defaultdeserializer>class: v8.DefaultDeserializer</h3><p>A subclass of <a href=#v8_class_v8_deserializer><code>Deserializer</code></a> corresponding to the format written by <a href=#v8_class_v8_defaultserializer><code>DefaultSerializer</code></a>.</p></div></div></div></body><script src=js/all.js></script></html>